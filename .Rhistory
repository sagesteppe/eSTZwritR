select(-SpellCk.gGRP, -Match, -SpellCk.taxon_rank,
-Full_name, -Genus, -Epithet, -Infrarank, -Infraspecies) |>
rename(Full_name = SpellCk.taxon_name, Genus = SpellCk.genus, Epithet = SpellCk.species,
Infrarank = SpellCk.infraspecific_rank, Infraspecies = SpellCk.infraspecies)
View(data)
names <- sf::st_drop_geometry(data) %>%
pull(Full_name)
pow_res <- lapply(names,
powo_searcher) %>%
bind_rows()
pow_res <- lapply(names,
powo_searcher) %>%
bind_rows()
data <- bind_cols(data, pow_res)
rm(names, pow_res)
data <- data %>%
sf::st_as_sf()
# I don' like Senecio crassulus for S. int, I also don't like
# Wyethia sagittata , nor Caralluma subulata
skips <- c('Grindelia camporum', 'Asclepias subulata', 'Amsinckia retrorsa', 'Sagittaria montevidensis subsp. calycina' )
data <- sf::st_drop_geometry(data)
skipped <- filter(data, Full_name %in% skips) %>%
mutate(
Family = POW_Family,
Infrarank = POW_Infrarank,
Infraspecies = POW_Infraspecies,
Slope = slope,
Aspect = aspect
)
skipped <- split_scientificName(skipped, 'POW_Name_authority')
d_sub <- data %>%
filter(! Full_name %in% skips) %>%
mutate(
Family = POW_Family,
Infrarank = POW_Infrarank,
Infraspecies = POW_Infraspecies,
Name_authority = POW_Name_authority,
Binomial_authority = POW_Binom_authority,
Genus = POW_Genus,
Epithet = POW_Epithet,
Slope = slope,
Aspect = aspect
)
View(skipped)
d_sub <- data %>%
filter(! Full_name %in% skips) %>%
mutate(
Family = POW_Family,
Infrarank = POW_Infrarank,
Infraspecies = POW_Infraspecies,
Name_authority = POW_Name_authority,
Binomial_authority = POW_Binom_authority,
Genus = POW_Genus,
Epithet = POW_Epithet,
Slope = slope,
Aspect = aspect
)
d_sub <- split_scientificName(d_sub, 'POW_Name_authority')
View(d_sub)
View(d_sub)
data1 <- bind_rows(skipped, d_sub) |>
# d_sub |>
#filter(Primary_Collector != 'Rosalind Rowe') |>
arrange(Primary_Collector, as.numeric(Collection_number))
View(data1)
colnames(d_sub)
d_sub <- data %>%
filter(! Full_name %in% skips) %>%
rename(Scientific_Name = x...sciName_col)
d_sub <- data %>%
filter(! Full_name %in% skips) %>%
rename(Scientific_Name = 'x...sciName_col')
# I don' like Senecio crassulus for S. int, I also don't like
# Wyethia sagittata , nor Caralluma subulata
skips <- c('Grindelia camporum', 'Asclepias subulata', 'Amsinckia retrorsa', 'Sagittaria montevidensis subsp. calycina' )
data <- sf::st_drop_geometry(data)
skipped <- filter(data, Full_name %in% skips) %>%
mutate(
Family = POW_Family,
Infrarank = POW_Infrarank,
Infraspecies = POW_Infraspecies,
Slope = slope,
Aspect = aspect
)
skipped <- split_scientificName(skipped, 'POW_Name_authority')
d_sub <- data %>%
filter(! Full_name %in% skips) %>%
#rename(Scientific_Name = 'x...sciName_col')
mutate(
Family = POW_Family,
Infrarank = POW_Infrarank,
Infraspecies = POW_Infraspecies,
Name_authority = POW_Name_authority,
Binomial_authority = POW_Binom_authority,
Genus = POW_Genus,
Epithet = POW_Epithet,
Slope = slope,
Aspect = aspect
)
View(d_sub)
View(skipped)
skipped <- filter(data, Full_name %in% skips) %>%
mutate(
Family = POW_Family,
Infrarank = POW_Infrarank,
Infraspecies = POW_Infraspecies,
Slope = slope,
Aspect = aspect
)
skipped <- filter(data, Full_name %in% skips) %>%
mutate(
Family = NA,
Infrarank = NA,
Infraspecies = NA,
Name_authority = POW_Name_authority,
Binomial_authority = case_when(
Full_name == 'Grindelia camporum' ~ 'Greene',
Full_name == 'Asclepias subulata' ~ 'Decne.',
Full_name == 'Amsinckia retrorsa' ~ 'Suksd.',
Full_name == 'Sagittaria montevidensis subsp. calycina' ~ 'Cham. & Schltdl.',
),
Epithet = ,
Slope = slope,
Aspect = aspect
)
# I don' like Senecio crassulus for S. int, I also don't like
# Wyethia sagittata , nor Caralluma subulata
skips <- c('Grindelia camporum', 'Asclepias subulata', 'Amsinckia retrorsa', 'Sagittaria montevidensis subsp. calycina' )
skipped <- filter(data, Full_name %in% skips) %>%
mutate(
Family = NA,
Infrarank = NA,
Infraspecies = NA,
Name_authority = POW_Name_authority,
Binomial_authority = case_when(
Full_name == 'Grindelia camporum' ~ 'Greene',
Full_name == 'Asclepias subulata' ~ 'Decne.',
Full_name == 'Amsinckia retrorsa' ~ 'Suksd.',
Full_name == 'Sagittaria montevidensis subsp. calycina' ~ 'Cham. & Schltdl.',
),
Epithet = ,
Slope = slope,
Aspect = aspect
)
skipped <- filter(data, Full_name %in% skips) %>%
mutate(
Family = NA,
Infrarank = NA,
Infraspecies = NA,
Name_authority = POW_Name_authority,
Binomial_authority = case_when(
Full_name == 'Grindelia camporum' ~ 'Greene',
Full_name == 'Asclepias subulata' ~ 'Decne.',
Full_name == 'Amsinckia retrorsa' ~ 'Suksd.',
Full_name == 'Sagittaria montevidensis subsp. calycina' ~ 'Cham. & Schltdl.'
),
Epithet = ,
Slope = slope,
Aspect = aspect
)
skipped <- filter(data, Full_name %in% skips) %>%
mutate(
Family = NA,
Infrarank = NA,
Infraspecies = NA,
Name_authority = POW_Name_authority,
Binomial_authority = case_when(
Full_name == 'Grindelia camporum' ~ 'Greene',
Full_name == 'Asclepias subulata' ~ 'Decne.',
Full_name == 'Amsinckia retrorsa' ~ 'Suksd.',
Full_name == 'Sagittaria montevidensis subsp. calycina' ~ 'Cham. & Schltdl.',
default = as.character(x)
),
Epithet = ,
Slope = slope,
Aspect = aspect
)
?case_when()
skipped <- filter(data, Full_name %in% skips) %>%
mutate(
Family = NA,
Infrarank = NA,
Infraspecies = NA,
Name_authority = POW_Name_authority,
Binomial_authority = case_when(
Full_name == 'Grindelia camporum' ~ 'Greene',
Full_name == 'Asclepias subulata' ~ 'Decne.',
Full_name == 'Amsinckia retrorsa' ~ 'Suksd.',
Full_name == 'Sagittaria montevidensis subsp. calycina' ~ 'Cham. & Schltdl.',
.default = as.character(x)
),
Epithet = ,
Slope = slope,
Aspect = aspect
)
skipped <- filter(data, Full_name %in% skips) %>%
mutate(
Family = NA,
Infrarank = NA,
Infraspecies = NA,
Name_authority = POW_Name_authority,
Binomial_authority = case_when(
Full_name == 'Grindelia camporum' ~ 'Greene',
Full_name == 'Asclepias subulata' ~ 'Decne.',
Full_name == 'Amsinckia retrorsa' ~ 'Suksd.',
Full_name == 'Sagittaria montevidensis subsp. calycina' ~ 'Cham. & Schltdl.',
.default = NA
),
Epithet = ,
Slope = slope,
Aspect = aspect
)
skipped <- filter(data, Full_name %in% skips) %>%
mutate(
Family = NA,
Infrarank = NA,
Infraspecies = NA,
Name_authority = POW_Name_authority,
Binomial_authority = case_when(
Full_name == 'Grindelia camporum' ~ 'Greene',
Full_name == 'Asclepias subulata' ~ 'Decne.',
Full_name == 'Amsinckia retrorsa' ~ 'Suksd.',
Full_name == 'Sagittaria montevidensis subsp. calycina' ~ 'Cham. & Schltdl.',
.default = NA
),
Slope = slope,
Aspect = aspect
)
colnames(skipped)
skipped <- filter(data, Full_name %in% skips) %>%
mutate(
Family = NA,
Infrarank = if_else(Full_name == 'Sagittaria montevidensis subsp. calycina', 'subsp.', NA),
Infraspecies = if_else(Full_name == 'Sagittaria montevidensis subsp. calycina', 'calycina', NA),
Infraspecific_authority = if_else(Full_name == 'Sagittaria montevidensis subsp. calycina', '(Engelm.) Bogin', NA),
Binomial_authority = case_when(
Full_name == 'Grindelia camporum' ~ 'Greene',
Full_name == 'Asclepias subulata' ~ 'Decne.',
Full_name == 'Amsinckia retrorsa' ~ 'Suksd.',
Full_name == 'Sagittaria montevidensis subsp. calycina' ~ 'Cham. & Schltdl.',
),
Name_authority = POW_Name_authority,
Slope = slope,
Aspect = aspect
)
View(skipped)
d_sub <- data %>%
filter(! Full_name %in% skips) %>%
mutate(
Family = POW_Family,
Infrarank = POW_Infrarank,
Infraspecies = POW_Infraspecies,
Name_authority = POW_Name_authority,
Binomial_authority = POW_Binom_authority,
Genus = POW_Genus,
Epithet = POW_Epithet,
Slope = slope,
Aspect = aspect
)
data1 <- bind_rows(skipped, d_sub) |>
# d_sub |>
#filter(Primary_Collector != 'Rosalind Rowe') |>
arrange(Primary_Collector, as.numeric(Collection_number))
View(data1)
d_sub <- data %>%
filter(! Full_name %in% skips) %>%
mutate(
Family = POW_Family,
Infrarank = POW_Infrarank,
Infraspecies = POW_Infraspecies,
Infraspecific_authority = POW_Infra_authority,
Name_authority = POW_Name_authority,
Binomial_authority = POW_Binom_authority,
Genus = POW_Genus,
Epithet = POW_Epithet,
Slope = slope,
Aspect = aspect
)
data1 <- bind_rows(skipped, d_sub) |>
# d_sub |>
#filter(Primary_Collector != 'Rosalind Rowe') |>
arrange(Primary_Collector, as.numeric(Collection_number))
View(data1)
# I don' like Senecio crassulus for S. int, I also don't like
# Wyethia sagittata , nor Caralluma subulata
skips <- c('Grindelia camporum', 'Asclepias subulata', 'Amsinckia retrorsa', 'Sagittaria montevidensis subsp. calycina' )
data <- sf::st_drop_geometry(data)
skipped <- filter(data, Full_name %in% skips) %>%
mutate(
Family = NA,
Infrarank = if_else(Full_name == 'Sagittaria montevidensis subsp. calycina', 'subsp.', NA),
Infraspecies = if_else(Full_name == 'Sagittaria montevidensis subsp. calycina', 'calycina', NA),
Infraspecific_authority = if_else(Full_name == 'Sagittaria montevidensis subsp. calycina', '(Engelm.) Bogin', NA),
Binomial_authority = case_when(
Full_name == 'Grindelia camporum' ~ 'Greene',
Full_name == 'Asclepias subulata' ~ 'Decne.',
Full_name == 'Amsinckia retrorsa' ~ 'Suksd.',
Full_name == 'Sagittaria montevidensis subsp. calycina' ~ 'Cham. & Schltdl.',
),
Name_authority = POW_Name_authority,
Slope = slope,
Aspect = aspect
)
d_sub <- data %>%
filter(! Full_name %in% skips) #%>%
View(d_sub)
d_sub <- data %>%
filter(! Full_name %in% skips) %>%
mutate(
Family = POW_Family,
Infrarank = POW_Infrarank,
Infraspecies = POW_Infraspecies,
Infraspecific_authority = POW_Infra_authority,
Name_authority = POW_Name_authority,
Binomial_authority = POW_Binom_authority,
Genus = POW_Genus,
Epithet = POW_Epithet,
Slope = slope,
Aspect = aspect
)
# I don' like Senecio crassulus for S. int, I also don't like
# Wyethia sagittata , nor Caralluma subulata
skips <- c('Grindelia camporum', 'Asclepias subulata', 'Amsinckia retrorsa', 'Sagittaria montevidensis subsp. calycina', 'Balsamorhiza sagittata')
d_sub <- data %>%
filter(! Full_name %in% skips) %>%
mutate(
Family = POW_Family,
Infrarank = POW_Infrarank,
Infraspecies = POW_Infraspecies,
Infraspecific_authority = POW_Infra_authority,
Name_authority = POW_Name_authority,
Binomial_authority = POW_Binom_authority,
Genus = POW_Genus,
Epithet = POW_Epithet,
Slope = slope,
Aspect = aspect
)
View(d_sub)
data1 <- bind_rows(skipped, d_sub) |>
# d_sub |>
#filter(Primary_Collector != 'Rosalind Rowe') |>
arrange(Primary_Collector, as.numeric(Collection_number))
View(skipped)
View(data1)
skipped <- filter(data, Full_name %in% skips) %>%
mutate(
Family = POW_Family,
Infrarank = if_else(Full_name == 'Sagittaria montevidensis subsp. calycina', 'subsp.', NA),
Infraspecies = if_else(Full_name == 'Sagittaria montevidensis subsp. calycina', 'calycina', NA),
Infraspecific_authority = if_else(Full_name == 'Sagittaria montevidensis subsp. calycina', '(Engelm.) Bogin', NA),
Binomial_authority = case_when(
Full_name == 'Grindelia camporum' ~ 'Greene',
Full_name == 'Asclepias subulata' ~ 'Decne.',
Full_name == 'Amsinckia retrorsa' ~ 'Suksd.',
Full_name == 'Balsamorhiza sagittata' ~ '(Pursh) Nutt.',
Full_name == 'Sagittaria montevidensis subsp. calycina' ~ 'Cham. & Schltdl.',
),
Slope = slope,
Aspect = aspect
) |>
unite(Name_authority, Genus, Epithet, Binomial_authority, Infrarank, Infraspecies, Infraspecific_authority, remove = F, drop_na = T)
?unite
skipped <- filter(data, Full_name %in% skips) %>%
mutate(
Family = POW_Family,
Infrarank = if_else(Full_name == 'Sagittaria montevidensis subsp. calycina', 'subsp.', NA),
Infraspecies = if_else(Full_name == 'Sagittaria montevidensis subsp. calycina', 'calycina', NA),
Infraspecific_authority = if_else(Full_name == 'Sagittaria montevidensis subsp. calycina', '(Engelm.) Bogin', NA),
Binomial_authority = case_when(
Full_name == 'Grindelia camporum' ~ 'Greene',
Full_name == 'Asclepias subulata' ~ 'Decne.',
Full_name == 'Amsinckia retrorsa' ~ 'Suksd.',
Full_name == 'Balsamorhiza sagittata' ~ '(Pursh) Nutt.',
Full_name == 'Sagittaria montevidensis subsp. calycina' ~ 'Cham. & Schltdl.',
),
Slope = slope,
Aspect = aspect
) |>
unite(Name_authority, Genus, Epithet, Binomial_authority, Infrarank, Infraspecies, Infraspecific_authority, remove = F, na.rm = T)
View(skipped)
d_sub <- data %>%
filter(! Full_name %in% skips) %>%
mutate(
Family = POW_Family,
Infrarank = POW_Infrarank,
Infraspecies = POW_Infraspecies,
Infraspecific_authority = POW_Infra_authority,
Name_authority = POW_Name_authority,
Binomial_authority = POW_Binom_authority,
Genus = POW_Genus,
Epithet = POW_Epithet,
Slope = slope,
Aspect = aspect
)
data1 <- bind_rows(skipped, d_sub) |>
# d_sub |>
#filter(Primary_Collector != 'Rosalind Rowe') |>
arrange(Primary_Collector, as.numeric(Collection_number))
View(data1)
skipped <- filter(data, Full_name %in% skips) %>%
mutate(
Family = POW_Family,
Infrarank = if_else(Full_name == 'Sagittaria montevidensis subsp. calycina', 'subsp.', NA),
Infraspecies = if_else(Full_name == 'Sagittaria montevidensis subsp. calycina', 'calycina', NA),
Infraspecific_authority = if_else(Full_name == 'Sagittaria montevidensis subsp. calycina', '(Engelm.) Bogin', NA),
Binomial_authority = case_when(
Full_name == 'Grindelia camporum' ~ 'Greene',
Full_name == 'Asclepias subulata' ~ 'Decne.',
Full_name == 'Amsinckia retrorsa' ~ 'Suksd.',
Full_name == 'Balsamorhiza sagittata' ~ '(Pursh) Nutt.',
Full_name == 'Sagittaria montevidensis subsp. calycina' ~ 'Cham. & Schltdl.',
),
Slope = slope,
Aspect = aspect
) |>
unite(Name_authority, Genus, Epithet, Binomial_authority, Infrarank, Infraspecies, Infraspecific_authority,
remove = F, na.rm = T, sep = ' ')
d_sub <- data %>%
filter(! Full_name %in% skips) %>%
mutate(
Family = POW_Family,
Infrarank = POW_Infrarank,
Infraspecies = POW_Infraspecies,
Infraspecific_authority = POW_Infra_authority,
Name_authority = POW_Name_authority,
Binomial_authority = POW_Binom_authority,
Genus = POW_Genus,
Epithet = POW_Epithet,
Slope = slope,
Aspect = aspect
)
data1 <- bind_rows(skipped, d_sub) |>
# d_sub |>
#filter(Primary_Collector != 'Rosalind Rowe') |>
arrange(Primary_Collector, as.numeric(Collection_number))
View(data1)
rm(d_sub, skipped, skips)
# first ensure the columns are in the same order as google sheets
processed_cols <- read_sheet('1iOQBNeGqRJ3yhA-Sujas3xZ2Aw5rFkktUKv3N_e4o8M',
sheet = 'Processed - Examples') %>%
colnames()
# first ensure the columns are in the same order as google sheets
processed_cols <- read_sheet('1iOQBNeGqRJ3yhA-Sujas3xZ2Aw5rFkktUKv3N_e4o8M',
sheet = 'Processed - Examples') %>%
colnames()
df <- data1 %>%
sf::st_drop_geometry() %>%
relocate(any_of(processed_cols)) %>%
arrange(Primary_Collector, Collection_number)
df |>
sf::st_drop_geometry() %>%
sheet_append(ss = '1iOQBNeGqRJ3yhA-Sujas3xZ2Aw5rFkktUKv3N_e4o8M',
sheet = 'Processed California - 2024')
View(data1)
skipped <- filter(data, Full_name %in% skips) %>%
mutate(
Family = POW_Family,
Infrarank = if_else(Full_name == 'Sagittaria montevidensis subsp. calycina', 'subsp.', NA),
Infraspecies = if_else(Full_name == 'Sagittaria montevidensis subsp. calycina', 'calycina', NA),
Infraspecific_authority = if_else(Full_name == 'Sagittaria montevidensis subsp. calycina', '(Engelm.) Bogin', NA),
Binomial_authority = case_when(
Full_name == 'Grindelia camporum' ~ 'Greene',
Full_name == 'Asclepias subulata' ~ 'Decne.',
Full_name == 'Amsinckia retrorsa' ~ 'Suksd.',
Full_name == 'Balsamorhiza sagittata' ~ '(Pursh) Nutt.',
Full_name == 'Sagittaria montevidensis subsp. calycina' ~ 'Cham. & Schltdl.',
),
Slope = slope,
Aspect = aspect
#  Epithet = if_else('Sagittaria montevidensis subsp. calycina', 'montevidensis', Epithet),
) |>
unite(Name_authority,
Genus, Epithet, Binomial_authority, Infrarank, Infraspecies, Infraspecific_authority,
remove = F, na.rm = T, sep = ' ')
# I don' like Senecio crassulus for S. int, I also don't like
# Wyethia sagittata , nor Caralluma subulata
skips <- c('Grindelia camporum', 'Asclepias subulata', 'Amsinckia retrorsa', 'Sagittaria montevidensis subsp. calycina', 'Balsamorhiza sagittata')
data <- sf::st_drop_geometry(data)
skipped <- filter(data, Full_name %in% skips) %>%
mutate(
Family = POW_Family,
Infrarank = if_else(Full_name == 'Sagittaria montevidensis subsp. calycina', 'subsp.', NA),
Infraspecies = if_else(Full_name == 'Sagittaria montevidensis subsp. calycina', 'calycina', NA),
Infraspecific_authority = if_else(Full_name == 'Sagittaria montevidensis subsp. calycina', '(Engelm.) Bogin', NA),
Binomial_authority = case_when(
Full_name == 'Grindelia camporum' ~ 'Greene',
Full_name == 'Asclepias subulata' ~ 'Decne.',
Full_name == 'Amsinckia retrorsa' ~ 'Suksd.',
Full_name == 'Balsamorhiza sagittata' ~ '(Pursh) Nutt.',
Full_name == 'Sagittaria montevidensis subsp. calycina' ~ 'Cham. & Schltdl.',
),
Slope = slope,
Aspect = aspect
#  Epithet = if_else('Sagittaria montevidensis subsp. calycina', 'montevidensis', Epithet),
) |>
unite(Name_authority,
Genus, Epithet, Binomial_authority, Infrarank, Infraspecies, Infraspecific_authority,
remove = F, na.rm = T, sep = ' ')
View(skipped)
df |>
sf::st_drop_geometry() %>%
sheet_append(ss = '1iOQBNeGqRJ3yhA-Sujas3xZ2Aw5rFkktUKv3N_e4o8M',
sheet = 'Processed California - 2024')
df |>
sf::st_drop_geometry() %>%
sheet_append(ss = '1iOQBNeGqRJ3yhA-Sujas3xZ2Aw5rFkktUKv3N_e4o8M',
sheet = 'Processed California - 2024')
df |>
filter(Primary_Collector %in%
c('Rosalind Rowe', 'Piper Lawrence', 'Clara Landon', 'Logan Rees', 'Joceline Moreles')) |>
write_sheet('1iOQBNeGqRJ3yhA-Sujas3xZ2Aw5rFkktUKv3N_e4o8M',
sheet = 'Processed California - 2024')
